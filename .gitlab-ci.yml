image: docker:stable

services:
  - docker:dind

before_script:
  - apk --no-cache add curl

test:
    tags:
        - docker
    stage: test
    script:
        - docker build -t ${CI_PROJECT_PATH} -f docker/Dockerfile .
        - curl --request POST --form "token=$CI_JOB_TOKEN" --form "ref=${CI_COMMIT_REF_NAME}" https://gitlab.polyswarm.io/api/v4/projects/${CI_CUSTOM_PROJECT_ID_E2E}/trigger/pipeline
