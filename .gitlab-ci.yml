image: docker:stable

services:
  - docker:dind

before_script:
  - apk --no-cache add curl

#build-docker:
#    tags:
#        - docker
#    stage: test
#    script:
#        - docker build -t ${CI_PROJECT_PATH} -f docker/Dockerfile .
#
kick-e2e:
    tags:
        - docker
    stage: deploy
    script:
      - echo "CI_PROJECT_NAME is $CI_PROJECT_NAME"
      - echo "CI_PROJECT_NAMESPACE is $CI_PROJECT_NAMESPACE"
      - echo "CI_PROJECT_URL is $CI_PROJECT_URL"
      - curl
        --request POST
        --form "token=$CI_JOB_TOKEN"
        --form "variables[SOURCE_BRANCH]=$CI_COMMIT_REF_NAME"
        --form ref=refactor
        https://gitlab.polyswarm.io/api/v4/projects/${CI_CUSTOM_PROJECT_ID_E2E}/trigger/pipeline > /dev/null

