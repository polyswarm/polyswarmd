image: docker:stable

services:
  - docker:dind

before_script:
  - apk --no-cache add curl

#build-docker:
#    tags:
#        - docker
#    stage: test
#    script:
#        - docker build -t ${CI_PROJECT_PATH} -f docker/Dockerfile .

kick-e2e:
    tags:
        - docker
    stage: deploy
    script:
      - curl
        -s
        -o /dev/null
        -w "%{http_code}"
        --request POST
        --form "token=$CI_JOB_TOKEN"
        --form "variables[SOURCE_PROJECT]=$CI_PROJECT_NAMESPACE/$CI_PROJECT_NAME"
        --form "variables[SOURCE_BRANCH]=$CI_COMMIT_REF_NAME"
        --form ref=master
        https://gitlab.polyswarm.io/api/v4/projects/${CI_CUSTOM_PROJECT_ID_E2E}/trigger/pipeline
